@{
    Layout = null;
}
@(Html.X().GridPanel()
      .Region(Region.Center)
      .Title("项目列表")
      .Header(true)
      .Store(
            Html.X().Store()
                .Proxy(Html.X()
                           .AjaxProxy()
                           .Reader(Html.X().JsonReader().Root("data"))
                           .Url(Url.Action("GetProjects"))
                 )
                .Model(Html.X()
                           .Model()
                           .Fields(
                                Html.X().ModelField().Name("Id")
                                , Html.X().ModelField().Name("ProjectName")
                                ,Html.X().ModelField().Name("GK")
                                ,Html.X().ModelField().Name("YZ")
                                ,Html.X().ModelField().Name("JL")
                           )
                )
      )
      .ColumnModel(
            Html.X().Column().Text("项目名称").DataIndex("ProjectName")
           , Html.X().Column().Text("项目概况").DataIndex("GK")
           , Html.X().Column().Text("业主单位").DataIndex("YZ")
           , Html.X().Column().Text("挂靠监理单位").DataIndex("JL")
           , Html.X().ComponentColumn().Text("监理合同段信息").Component(items =>
           {
               items.Add(
                   Html.X()
                       .Button()
                       .Text("合同段信息")
                       .Listeners(events => {
                           events.Click.Handler = @"//this.menu.down('grid').setTitle('【'+this.record.get('ProjectName')+'】监理合同段信息')
                                                    //this.menu.down('grid').getStore().reload({params:{Id:this.record.get('Id')}})
                                                   ";
                       })
                       .Menu(Html.X().Menu().Frame(true).ItemsFromPartial("_ContractInfo",false)));
           })
           , Html.X().ComponentColumn().Text("施工单位").Component(items =>
           {
               items.Add(
                   Html.X()
                    .Button()
                    .Text("施工单位")
                    .Listeners(events =>
                    {
                        events.Click.Handler = @"//this.menu.down('grid').setTitle('【'+this.record.get('ProjectName')+'】施工单位信息')
                                                //this.menu.down('grid').getStore().reload({params:{Id:this.record.get('Id')}})
                                                ";
                    })
                    .Menu(Html.X().Menu().Frame(true).ItemsFromPartial("_ConstructionInfo", false)));
           })
      )
      .DockedItems(
            Html.X().FormPanel()
                .BodyPadding(5)
                .Border(false)
                .BorderSpec("0 1")
                .Layout(LayoutType.HBox)
                .Items(
                    Html.X().TextField().LabelAlign(LabelAlign.Right).Width(165).LabelWidth(65).FieldLabel("项目名称"),
                    Html.X().Button().Text("查询").Icon(Icon.Magnifier).Margins("0 0 0 10")
                )
        )
      .TopBar(
            Html.X().Toolbar()
                .Items(
                    Html.X().Button()
                        .Text("新增项目")
                        .Icon(Icon.Add)
                        .Handler("App.Project_Window.show()")
                )
      )
      .BottomBar(Html.X().PagingToolbar())
)

@(Html.EditorWindow()
      .ID("Project_Window")
      .Title("项目信息")
      .Hidden(true)
      .Border(false)
      .BodyBorder(0)
      .Width(760)
      .Height(450)
      .Layout(Ext.Net.LayoutType.Border)
      .ItemsFromPartial("ProjectForm")
)