@model PM_PersonBaseInfo
@{
    Layout = null;
    bool Disabled = true;
    if(Model!=null)
    {
        Disabled = Model.IsCreate;
    }
}

@(Html.EditorWindow()
     .ID("Person_Window")
     .Title("人员信息")
     .Border(false)
     .Width(700)
    .CloseAction(CloseAction.Destroy)
     .Layout(LayoutType.Border)
     .Height(450)
     .Items(
        Html.X()
    .MenuPanel()
    .ID("PersonForm_MenuPanel")
    .Width(150)
    .Region(Region.West)
    .Split(true)
    .SelectedIndex(0)
    .Menu(menus =>
    {
        menus.ID = "PersonForm_Menu";
        menus.Items.Add(Html.X().MenuItem().Text("基本信息").Listeners(events => events.Click.Handler = "App.Person_Card.getLayout().setActiveItem(0)"));
        menus.Items.Add(Html.X().MenuItem().Text("教育信息").Disabled(Disabled).Listeners(events => events.Click.Handler = "App.Person_Card.getLayout().setActiveItem(1)"));
        menus.Items.Add(Html.X().MenuItem().Text("职称信息").Disabled(Disabled).Listeners(events => events.Click.Handler = "App.Person_Card.getLayout().setActiveItem(2)"));
        menus.Items.Add(Html.X().MenuItem().Text("工作经历").Disabled(Disabled).Listeners(events => events.Click.Handler = "App.Person_Card.getLayout().setActiveItem(3)"));
        menus.Items.Add(Html.X().MenuItem().Text("证件信息").Disabled(Disabled).Listeners(events => events.Click.Handler = "App.Person_Card.getLayout().setActiveItem(4)"));
    }),

Html.X()
    .Container()
    .Border(false)
    .ID("Person_Card")
    .Region(Region.Center)
    .Layout(LayoutType.Card)
    .ActiveIndex(0)
    .Items(
        Html.X()
            .FormPanel()
            .ID("Person_Basic_Info")
            .Title("基本信息")
            .Layout(LayoutType.Border)
            .Url(Url.Action("Save"))
            .JsonSubmit(true)
            .TopBar(Html.X()
                .Toolbar().Items(toolbarItems =>
                {
                    toolbarItems.Add(Html.X()
                                        .Button()
                                        .Text("保存")
                                        .Icon(Icon.Disk)
                                        .Listeners(events =>
                                        {
                                            events.Click.Handler = "this.up('form').submit()";// Url.Action("Save");
                                        })
                                    );
                }))
            .Defaults(defaults =>
            {
                defaults.Add(new { MsgTarget = "under" });
            })
            .ItemsFromPartial("_BaseInfo", Model)
        , Html.X()
            .Panel()
            .Title("教育信息")
            .Header(false)
            .Layout(LayoutType.Fit)
            .BodyStyle("border:0px")
            .ItemsFromPartial("_EducationInfo", new EduViewModel())
            .Listeners(events =>
            {
                events.Activate.Handler = @"
if(App.Person_Education_Tab.getActiveTab().getId()!='Person_Edu_Grid'){
    App.Person_Education_Tab.setActiveTab(App.Person_Edu_Grid)
}
else{
    App.Person_Edu_Grid.fireEvent('activate');
}";
            })
        , Html.X()
            .Panel()
            .Title("职称信息")
            .Layout(LayoutType.Fit)
            .BodyStyle("border:0px")
            .ItemsFromPartial("_TitlesInfo", new PM_PersonPositionalTitlesInfo())
            .Listeners(events =>
            {
                events.Activate.Handler = "App.Person_Titles_Store.reload({params:{personId:App.person_Info_Id.getValue()}})";
            })
        , Html.X()
            .Panel()
            .Title("工作经历")
            .BodyStyle("border:0px")
            .Layout(LayoutType.Fit)
            .ItemsFromPartial("_WorkInfo", new PM_PersonWorkExperienceInfo())
            .Listeners(events =>
            {
                events.Activate.Handler = "App.Person_Works_Store.reload({params:{personId:App.person_Info_Id.getValue()}})";
            })
        , Html.X()
            .Panel()
            .Title("证件信息")
            .BodyStyle("border:0px")
            .Layout(LayoutType.Fit)
            .ItemsFromPartial("_CertInfo", new PM_PersonCertificateInfo())
            .Listeners(events =>
            {
                events.Activate.Handler = "App.Person_Certs_Store.reload({params:{personId:App.person_Info_Id.getValue()}})";
            })
    )

     )

)
