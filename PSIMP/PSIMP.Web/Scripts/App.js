Ext.net.ResourceMgr.init({ isMVC: true }); Ext.onReady(function () {
    Ext.ns("App.direct"); Ext.apply(App.direct, { SaveEdu: function (isPhantom, personId, values, config) { return Ext.net.DirectMethod.request("SaveEdu", Ext.applyIf(config || {}, { params: { isPhantom: isPhantom, personId: personId, values: values }, url: "/Person/SaveEdu" })); }, SaveTrain: function (isPhantom, personId, values, config) { return Ext.net.DirectMethod.request("SaveTrain", Ext.applyIf(config || {}, { params: { isPhantom: isPhantom, personId: personId, values: values }, url: "/Person/SaveTrain" })); } }); Ext.create("Ext.ux.desktop.App", {
        getModules: function () {
            return [new Ext.create("Ext.ux.desktop.Module", { id: "PersonModule", window: function () { return { id: "win_PersonModule", border: false, frame: true, height: 500, hidden: false, width: 960, xtype: "window", items: [{ xtype: "container", items: [{ id: "Person_View", cls: "person-view", padding: 0, xtype: "panel", region: "center", items: [{ id: "PersonView", border: false, tpl: Ext.create("Ext.net.XTemplate", { html: ["<tpl for=\".\">", "<div class=\"user-card\">", "<div class=\"img\" style=\"height: 100px; width: 75px;\">", "<img style=\"width:75px;height:100px\" src=\"/images/person/{Picture}\" alt=\"{Name}\">", "</div>", "<div class=\"img-txt\">", "<h4>{Name}</h4>", "<p class=\"ellipsis\">{[values.Sex==0?'男':'女']} {Age}岁</p>", "<p class=\"ellipsis\">电话:{Telephone}</p>", "<p class=\"ellipsis\" style=\"word-break:normal;white-space:nowrap;text-overflow:ellipsis; \">邮箱:<a href=\"mailto:{Email}\">{Email}</a></p>", "<div class=\"actions\">", "<a onclick=\"person.edit({Id})\" class=\"btn-edit\">", "<s class=\"icon sp-mk-edit\"></s>", "<span class=\"txt\">编辑</span>", "", "</a>", "<a onclick=\"person.del({Id})\"  class=\"btn-delete\">", "<s class=\"icon sp-mk-del\"></s>", "<span class=\"txt\">删除</span>", "</a>", "</div>", "</div>", "</div>", "</tpl>", "<div class=\"x-clear\"></div>", ""] }), xtype: "dataview", autoScroll: true, itemSelector: "div.user-card", overItemCls: "x-item-over", store: { model: Ext.define(Ext.id(), { extend: "Ext.data.Model", fields: [{ name: "Name", type: "string" }, { name: "Sex", type: "string" }, { name: "Height", type: "int" }, { name: "Census", type: "string" }, { name: "IDCard", type: "string" }, { name: "Age", type: "int" }, { name: "Telephone", type: "string" }, { name: "Email", type: "string" }, { name: "Picture", type: "string" }, { name: "Education" }, { name: "Train" }, { name: "Id", type: "int" }, { name: "CreateTime", type: "date", dateFormat: "Y-m-d\\TH:i:s" }, { name: "UpdateTime", type: "date", dateFormat: "Y-m-d\\TH:i:s" }, { name: "CreateUser", type: "string" }, { name: "UpdateUser", type: "string" }, { name: "IsDelete", type: "boolean" }], idProperty: "Id", validations: [{ type: "presence", message: "Id 字段是必需的。" }, { type: "presence", field: "Id", message: "Id 字段是必需的。" }, { type: "presence", message: "IsDelete 字段是必需的。" }, { type: "presence", field: "IsDelete", message: "IsDelete 字段是必需的。" }] }), storeId: "Person_Store", autoLoad: true, proxy: { type: "ajax", api: { read: "/Person/GetPersons" }, reader: { type: "json", root: "data" } } }, trackOver: true }, { border: false, xtype: "grid", columns: { items: [{ xtype: "templatecolumn", align: "center", dataIndex: "Picture", text: "照片", tpl: "<img style=\"width:38px;height:50px\" src=\"/images/Person/{Picture}\" alt=\"{Name}\">" }, { hidden: true, dataIndex: "Id", text: "Id" }, { dataIndex: "Name", text: "姓名" }, { dataIndex: "Telephone", text: "联系号码" }, { dataIndex: "Age", text: "年龄" }, { dataIndex: "IDCard", text: "身份证号" }, { dataIndex: "Census", text: "户籍地" }, { dataIndex: "Height", text: "身高(CM)" }, { dataIndex: "Sex", text: "性别" }, { dataIndex: "Email", text: "电子邮件" }] }, store: "Person_Store" }], layout: "card", bbar: { xtype: "pagingtoolbar", displayInfo: true, listeners: { render: { fn: function (item) { this.bindStore(App.Person_Store) } } } }, header: false, tbar: { xtype: "toolbar", items: [{ xtype: "button", iconCls: "#Add", text: "新增人员", listeners: { click: { fn: person.create } } }, { xtype: "tbfill" }, { id: "idacbe98bb6a3c16aa", width: 150, xtype: "textfield", fieldLabel: "姓名", labelAlign: "right", labelWidth: 35, listeners: { change: { fn: function (item, newValue, oldValue) { var dataview = App.PersonView, store = dataview.store; store.suspendEvents(); store.clearFilter(); dataview.getSelectionModel().clearSelections(); store.resumeEvents(); store.filter({ property: 'Name', anyMatch: true, value: newValue }); } } } }, { id: "ida5896ac390f6bf66", width: 150, xtype: "combobox", fieldLabel: "排序", labelAlign: "right", labelWidth: 35, editable: false, queryMode: "local", triggerAction: "all", store: [["Name", "姓名"], ["Sex", "性别"]], listeners: { select: { fn: function (item, records) { App.PersonView.store.sort(this.getValue()); } } } }, { xtype: "tbseparator" }, { xtype: "button", handler: function () { App.Person_View.getLayout().setActiveItem(0) }, iconCls: "#Mail", pressed: true, toggleGroup: "person-view", tooltip: "名片视图" }, { xtype: "button", handler: function () { App.Person_View.getLayout().setActiveItem(1) }, iconCls: "#Table", toggleGroup: "person-view", tooltip: "列表视图" }] }, title: "人员列表" }, { id: "Person_Window", border: false, height: 520, width: 768, xtype: "window", items: [{ id: "PersonForm_MenuPanel", border: false, width: 150, xtype: "netmenupanel", region: "west", menu: { id: "PersonForm_Menu", floating: false, xtype: "menu", items: [{ text: "基本信息", listeners: { click: { fn: function (item, e) { App.Person_Card.getLayout().setActiveItem(0) } } } }, { disabled: true, text: "注册信息", listeners: { click: { fn: function (item, e) { App.Person_Card.getLayout().setActiveItem(1) } } } }, { disabled: true, text: "教育背景", listeners: { click: { fn: function (item, e) { App.Person_Card.getLayout().setActiveItem(2) } } } }, { disabled: true, text: "培训经历", listeners: { click: { fn: function (item, e) { App.Person_Card.getLayout().setActiveItem(3) } } } }, { disabled: true, text: "工作经历", listeners: { click: { fn: function (item, e) { App.Person_Card.getLayout().setActiveItem(4) } } } }, { disabled: true, text: "证书证件", listeners: { click: { fn: function (item, e) { App.Person_Card.getLayout().setActiveItem(5) } } } }] }, selectedIndex: 0 }, { id: "Person_Card", border: false, xtype: "container", region: "center", activeItem: 0, items: [{ id: "Person_Basic_Info", xtype: "form", defaults: { "msgTarget": "under" }, items: [{ border: false, padding: 5, width: 130, xtype: "container", region: "west", items: [{ frame: true, height: 160, width: 120, xtype: "fieldset", items: [{ id: "person_info_image", xtype: "netimage", imageUrl: "/Images/person/default.jpg" }], layout: "fit", title: "一寸照片" }, { xtype: "filefield", name: "TempPicture", buttonText: "选择文件", buttonOnly: true, listeners: { change: { fn: function (item, newValue, oldValue) { App.FileStatus_Label.setText('已选择文件') } } } }, { id: "FileStatus_Label", xtype: "netlabel", emptyText: "未选择文件" }] }, { border: false, xtype: "panel", region: "center", items: [{ id: "person_Info_Id", xtype: "hiddenfield", name: "Id", listeners: { change: { fn: person.setFormState } } }, { id: "person_info_picture", xtype: "hiddenfield", fieldLabel: "照片", name: "Picture", listeners: { change: { fn: person.setFormState } } }, { id: "Name", xtype: "textfield", fieldLabel: "姓名", name: "Name", allowBlank: false, blankText: "请输入人员姓名" }, { id: "Sex", xtype: "combobox", fieldLabel: "性别", name: "Sex", allowBlank: false, blankText: "请选择人员性别", editable: false, queryMode: "local", triggerAction: "all", store: [["0", "男"], ["1", "女"]] }, { id: "IDCard", xtype: "textfield", fieldLabel: "身份证号", name: "IDCard", allowBlank: false, blankText: "请输入身份证号码", regex: /[1-6]\d{5}(?:19|20)\d{2}(?:0\d|1[12])(?:0\d|[12]\d|3[01])\d{3}[\dXx]/, regexText: "请输入正确的18位身份证号码" }, { id: "Census", xtype: "textfield", fieldLabel: "户籍地", name: "Census", allowBlank: false, blankText: "请输入人员户籍" }, { id: "Height", xtype: "numberfield", fieldLabel: "身高(CM)", name: "Height", decimalSeparator: "." }, { id: "Age", xtype: "numberfield", fieldLabel: "年龄", name: "Age", decimalSeparator: "." }, { id: "Telephone", xtype: "textfield", fieldLabel: "联系号码", name: "Telephone" }, { id: "Email", xtype: "textfield", fieldLabel: "电子邮件", name: "Email", vtype: "email" }], bodyPadding: 10, header: false }], layout: "border", tbar: { xtype: "toolbar", items: [{ iconCls: "#Disk", text: "保存", listeners: { click: { fn: function (item, e) { this.up('form').submit() } } } }] }, title: "基本信息", url: "/Person/Save", jsonSubmit: true }, { items: [{ id: "idf19537cb873ce9dd", xtype: "textfield" }], bodyPadding: 10, title: "注册信息" }, { items: [{ store: { model: Ext.define(Ext.id(), { extend: "Ext.data.Model", fields: [{ name: "PersonId", type: "int" }, { name: "SchoolName", type: "string" }, { name: "BeginDate", type: "date", dateFormat: "Y-m-d\\TH:i:s" }, { name: "EndDate", type: "date", dateFormat: "Y-m-d\\TH:i:s" }, { name: "Discipline", type: "string" }, { name: "Degree", type: "string" }, { name: "Remark", type: "string" }, { name: "Person" }, { name: "Id", type: "int" }, { name: "CreateTime", type: "date", dateFormat: "Y-m-d\\TH:i:s" }, { name: "UpdateTime", type: "date", dateFormat: "Y-m-d\\TH:i:s" }, { name: "CreateUser", type: "string" }, { name: "UpdateUser", type: "string" }, { name: "IsDelete", type: "boolean" }], idProperty: "Id", validations: [{ type: "presence", message: "PersonId 字段是必需的。" }, { type: "presence", field: "PersonId", message: "PersonId 字段是必需的。" }, { type: "presence", message: "BeginDate 字段是必需的。" }, { type: "presence", field: "BeginDate", message: "BeginDate 字段是必需的。" }, { type: "presence", message: "Id 字段是必需的。" }, { type: "presence", field: "Id", message: "Id 字段是必需的。" }, { type: "presence", message: "IsDelete 字段是必需的。" }, { type: "presence", field: "IsDelete", message: "IsDelete 字段是必需的。" }] }), storeId: "Person_Edu_Store", readParameters: function (operation) { return { apply: { "id": App.person_Info_Id.getValue() } }; }, proxy: { type: "ajax", api: { read: "/Person/GetEducations" }, reader: { type: "json", root: "data" } } }, plugins: [{ ptype: "rowediting", errorSummary: false, saveBtnText: "保存", cancelBtnText: "取消", saveHandler: person.edu.validateSave, listeners: { canceledit: { fn: function (item, e) { if (e.record.phantom) { e.store.remove(e.record); } } } } }], xtype: "grid", bbar: { xtype: "pagingtoolbar", displayInfo: true, store: "Person_Edu_Store" }, tbar: { xtype: "toolbar", items: [{ iconCls: "#Add", text: "新增", listeners: { click: { fn: person.edu.create } } }, { itemId: "btnRemove", iconCls: "#Exclamation", text: "删除", listeners: { click: { fn: person.edu.del } } }] }, columns: { items: [{ hidden: true, dataIndex: "Id", editor: { id: "idaf26e2a088356fb1", xtype: "hiddenfield" }, hideable: false, text: "Id" }, { dataIndex: "SchoolName", editor: { id: "ida8f94df8ddf4191", xtype: "textfield", allowBlank: false, blankText: "请输入学校名称" }, text: "学校名称" }, { xtype: "datecolumn", dataIndex: "BeginDate", editor: { id: "id708ce1bec0356fb1", xtype: "datefield", allowBlank: false, blankText: "请选择入学时间", editable: false, format: "Y-m-d", submitFormat: "Y/n/j" }, text: "入学时间", format: "Y-m-d" }, { xtype: "datecolumn", dataIndex: "EndDate", editor: { id: "id6f35d23f0251efb1", xtype: "datefield", editable: false, format: "Y-m-d", submitFormat: "Y/n/j" }, text: "毕业时间", format: "Y-m-d" }, { dataIndex: "Discipline", editor: { id: "ida52a071a33e9f7b1", xtype: "textfield" }, text: "专业" }, { dataIndex: "Degree", editor: { id: "id4f286f46b7ffefb1", xtype: "textfield" }, text: "学位" }, { dataIndex: "Remark", editor: { id: "ide63fd1054a696fb1", xtype: "textareafield" }, text: "备注" }] }, emptyText: "没有教育背景的记录" }], layout: "fit", title: "教育背景", listeners: { activate: { fn: function (item) { App.Person_Edu_Store.reload() } } } }, { items: [{ store: { model: Ext.define(Ext.id(), { extend: "Ext.data.Model", fields: [{ name: "Agency", type: "string" }, { name: "DateTime", type: "date", dateFormat: "Y-m-d\\TH:i:s" }, { name: "Location", type: "string" }, { name: "Curriculum", type: "string" }, { name: "Certificate", type: "string" }, { name: "Details", type: "string" }, { name: "CertDetails", type: "string" }, { name: "PersonId", type: "int" }, { name: "Person" }, { name: "Id", type: "int" }, { name: "CreateTime", type: "date", dateFormat: "Y-m-d\\TH:i:s" }, { name: "UpdateTime", type: "date", dateFormat: "Y-m-d\\TH:i:s" }, { name: "CreateUser", type: "string" }, { name: "UpdateUser", type: "string" }, { name: "IsDelete", type: "boolean" }], idProperty: "Id", validations: [{ type: "presence", message: "DateTime 字段是必需的。" }, { type: "presence", field: "DateTime", message: "DateTime 字段是必需的。" }, { type: "presence", message: "PersonId 字段是必需的。" }, { type: "presence", field: "PersonId", message: "PersonId 字段是必需的。" }, { type: "presence", message: "Id 字段是必需的。" }, { type: "presence", field: "Id", message: "Id 字段是必需的。" }, { type: "presence", message: "IsDelete 字段是必需的。" }, { type: "presence", field: "IsDelete", message: "IsDelete 字段是必需的。" }] }), storeId: "Person_Train_Store", readParameters: function (operation) { return { apply: { "id": App.person_Info_Id.getValue() } }; }, proxy: { type: "ajax", api: { read: "/Person/GetTrains" }, reader: { type: "json", root: "data" } } }, plugins: [{ ptype: "rowediting", errorSummary: false, saveBtnText: "保存", cancelBtnText: "取消", saveHandler: person.edu.validateSave, listeners: { canceledit: { fn: function (item, e) { if (e.record.phantom) { e.store.remove(e.record); } } } } }], xtype: "grid", bbar: { xtype: "pagingtoolbar", displayInfo: true, store: "Person_Train_Store" }, tbar: { xtype: "toolbar", items: [{ iconCls: "#Add", text: "新增", listeners: { click: { fn: person.edu.create } } }, { itemId: "btnRemove", iconCls: "#Exclamation", text: "删除", listeners: { click: { fn: person.edu.del } } }] }, columns: { items: [{ hidden: true, dataIndex: "Id", editor: { id: "id1066bb971e8e6ab7", xtype: "hiddenfield" }, hideable: false, text: "Id" }, { dataIndex: "Agency", editor: { id: "idb18f6998e682d2b7", xtype: "textfield", allowBlank: false, blankText: "请输入培训机构" }, text: "培训机构" }, { xtype: "datecolumn", dataIndex: "DateTime", editor: { id: "idec51d0d4de16eff7", xtype: "datefield", allowBlank: false, blankText: "请选择培训时间", editable: false, format: "Y-m-d", submitFormat: "Y/n/j" }, text: "受训时间" }, { dataIndex: "Location", editor: { id: "idbaf82841de896ab7", xtype: "textfield" }, text: "培训地点" }, { dataIndex: "Curriculum", editor: { id: "idd4da348f06056ab7", xtype: "textfield" }, text: "受训课程" }, { dataIndex: "Certificate", editor: { id: "id3801669f64c436b7", xtype: "textfield" }, text: "获得证书" }, { dataIndex: "CertDetails", editor: { id: "id478c2835a58ceab7", xtype: "textareafield" }, text: "证书扫描" }, { dataIndex: "Details", editor: { id: "idefbe89c87a9a6ab7", xtype: "textareafield" }, text: "详细描述" }] }, emptyText: "没有教育背景的记录" }], layout: "fit", title: "培训经历", listeners: { activate: { fn: function (item) { App.Person_Train_Store.reload() } } } }, { items: [{ id: "id45fd9618b980983a", xtype: "textfield" }], bodyPadding: 10, title: "工作经历" }, { items: [{ id: "id64562ce9e6c89a19", xtype: "textfield" }], bodyPadding: 10, title: "证书证件" }], layout: "card" }], layout: "border", bodyBorder: 0, title: "人员信息", constrainHeader: true, constrainTo: "mainBody", listeners: { show: { fn: function (item) { this.up('window').mask() } }, close: { fn: function (item) { this.up('window').unmask() } } } }], layout: "fit" }], layout: "fit", title: "人员管理", iconCls: "person-shortcut16", constrainHeader: true, plain: true, listeners: { afterlayout: { fn: moduleShow } } }; }, launcher: { xtype: "menuitem", iconCls: "person-shortcut16", text: "人员管理" }, shortcut: { iconCls: "person-shortcut32", sortIndex: 0, name: "人员管理", module: "PersonModule" } }), new Ext.create("Ext.ux.desktop.Module", { id: "ProjectModule", window: function () { return { id: "win_ProjectModule", border: false, frame: true, height: 500, hidden: false, width: 860, xtype: "window", items: [{ xtype: "container", items: [{ width: 150, xtype: "treepanel", region: "west", split: true, autoScroll: true, collapsible: true, title: "所有项目", root: { id: "root", text: "Root", children: [{ id: "Project1", leaf: true, iconCls: X.net.RM.getIcon("Package"), text: "XXX工程(K111-K222)" }] }, rootVisible: false }, { xtype: "tabpanel", region: "center", items: [{ title: "项目概况" }, { title: "合同段信息" }, { title: "施工单位" }, { title: "挂靠监理单位" }], activeTab: 0 }], layout: "border" }], layout: "fit", title: "项目管理", constrainHeader: true, plain: true, listeners: { afterlayout: { fn: moduleShow } } }; }, launcher: { xtype: "menuitem", text: "项目管理" }, shortcut: { sortIndex: 0, name: "项目管理", module: "ProjectModule" } }), new Ext.create("Ext.ux.desktop.Module", {
                id: "PerformanceModule", window: function () {
                    return {
                        id: "win_PerformanceModule", border: false, frame: true, height: 500, hidden: false, width: 860, xtype: "window", items: [{
                            xtype: "container", items: [{
                                id: "GanttView", xtype: "panel", region: "center", layout: "fit", listeners: {
                                    render: {
                                        fn: function (item) {
                                            var myChart = new FusionCharts('/Flash/Gantt.swf', 'myChartId', '100%', '100%', '0', '0');
                                            myChart.setDataURL('/Performance/GanttData');
                                            myChart.render('GanttView-body');
                                        }
                                    }
                                }
                            }], layout: "border"
                        }], layout: "fit", title: "履约管理", constrainHeader: true, plain: true, listeners: { afterlayout: { fn: moduleShow } }
                    };
                }, launcher: { xtype: "menuitem", text: "履约管理" }, shortcut: { sortIndex: 0, name: "履约管理", module: "PerformanceModule" }
            }), new Ext.create("Ext.ux.desktop.Module", { id: "AssetModule", window: function () { return { id: "win_AssetModule", border: false, frame: true, height: 500, hidden: false, width: 860, xtype: "window", items: [{ xtype: "container", layout: "border" }], layout: "fit", title: "设备管理", constrainHeader: true, plain: true, listeners: { afterlayout: { fn: moduleShow } } }; }, launcher: { xtype: "menuitem", text: "设备管理" }, shortcut: { sortIndex: 0, name: "设备管理", module: "AssetModule" } }), new Ext.create("Ext.ux.desktop.Module", { id: "TenderModule", window: function () { return { id: "win_TenderModule", border: false, frame: true, height: 500, hidden: false, width: 860, xtype: "window", items: [{ xtype: "container", layout: "border" }], layout: "fit", title: "招投标管理", constrainHeader: true, plain: true, listeners: { afterlayout: { fn: moduleShow } } }; }, launcher: { xtype: "menuitem", text: "招投标管理" }, shortcut: { sortIndex: 0, name: "招投标管理", module: "TenderModule" } }), new Ext.create("Ext.ux.desktop.Module", { id: "ContractModule", window: function () { return { id: "win_ContractModule", border: false, frame: true, height: 500, hidden: false, width: 860, xtype: "window", items: [{ xtype: "container", items: [], layout: "border" }], layout: "fit", title: "合同管理", constrainHeader: true, plain: true, listeners: { afterlayout: { fn: moduleShow } } }; }, launcher: { xtype: "menuitem", text: "合同管理" }, shortcut: { sortIndex: 0, name: "合同管理", module: "ContractModule" } })];
        }, desktopConfig: { xtype: "panel", contextMenu: { xtype: "menu", items: [{ xtype: "menuitem", text: "显示桌面" }, { xtype: "menuseparator" }, { xtype: "menuitem", text: "平铺" }, { xtype: "menuitem", text: "层叠" }] }, shortcutContextMenu: { xtype: "menu", items: [{ xtype: "menuitem", text: "打开" }, { xtype: "menuseparator" }, { xtype: "menuitem", text: "重命名" }, { xtype: "menuitem", text: "删除" }] }, shortcutDefaults: { iconCls: "default-shortcut", textCls: "shortcut-label" } }, startConfig: { frame: true, xtype: "panel", tabConfig: {}, buttons: [{ iconCls: "#Lock", text: "锁定" }, { iconCls: "#Key", text: "退出" }], title: "开始菜单", iconCls: "#Application", toolConfig: { xtype: "toolbar", items: [{ xtype: "button", iconCls: "#User", text: "帐号管理" }, { xtype: "button", iconCls: "#UserKey", text: "权限管理" }, { xtype: "button", iconCls: "#Group", text: "组织机构" }] } }, taskbarConfig: { startBtnText: "开始", height: 30, xtype: "toolbar", hideQuickStart: true, trayWidth: 100, trayClock: { xtype: "trayclock", timeFormat: "G:i" } }
    }); Ext.net.ResourceMgr.registerIcon(["User", "UserKey", "Group", "Add", "Mail", "Table", "Exclamation", "Disk", "Package", "Application", "Lock", "Key"]);
});